# API Tests

- With an API we need to check as many entry points as possible sometimes an endpoint will be protected but another will not have the same protection.

## Kiterunner

- We can fetch the latest release [here](https://github.com/assetnote/kiterunner) or follow the guide if we want to build the binary.
  - Large routes list in kite fetchable [here](https://wordlists-cdn.assetnote.io/data/kiterunner/routes-large.kite.tar.gz)
  - Small routes list in kite fetchable[here](https://wordlists-cdn.assetnote.io/data/kiterunner/routes-small.kite.tar.gz)

- Useful commands:
  - Basic scan: `kr scan https://<ip>/ -w routes-large.kite`
  - Pass the Bearer token (to avoid getting too many 403): `sudo ./kr scan https://<IP>/ -w routes-small.kite -H 'Authorization: Bearer TOKEN-HERE'`
  - We can specify in the url /api/vX if we have it but kiterunner can also find it for us with the basic scan.
    Alissa Knight's whitepaper explains this very well: *"By default, when depth isn’t specified, Kiterunner will scan a target at 1 level deep, meaning if you specified a target of server.com, Kiterunner would scan server.com/api. At level 2, it would scan server.com/api/R4 and at level 3, it would scan server.com/api/R4/patient."*
  - To send to Burp Suite append the command with: `--proxy=http://127.0.0.1:8080` (this is done with replay not with scan)

## RESTler

*"RESTler, developed at Microsoft, is the world’s first stateful API fuzzer that automatically generates tests and automatic execution by first reading the OpenAPI specification in order to automatically find vulnerabilities in the API."*

- Fetch it [here](https://github.com/microsoft/restler-fuzzer)
- *"If you receive a nuget error NU1403 when building, a quick workaround is to clear your cache with this command: $ dotnet nuget locals all--clear"*
- Quite a pain to install on kali.

## Postman

### Setting up baseurl

To give the base url variable a valid value, select the root of the collection (here it would be Twitter API v2)  
![Example of collection](https://www.postman.com/_mk-www/assets/downloads/postman-downloads-product-screen.svg)  
And on the middle panel select variables. Add your host in the current value (for instance https://myhost.com), double click the url and select Set as variable.  
It should look like this:  
![Set as variable](https://csbygb.github.io/img/current-value.png)  
Set the proper authorization, configure postman with burp (if you do not know how check out Hakluke and Farah Hawa article in the resources below), and you should be able to send requests

### Bearer Token

If you use a bearer token and do not want to set up authentication, you can just add a current token in the Authozization tab or the collection's root.
**Important: Do not forget to Save your changes because it wont work if you don't**  
After this you just have to set the other to inherit auth from parent and you should be good to go.

## Tools

- [Postman](https://www.postman.com/downloads/)
- [Kiterunner](https://github.com/assetnote/kiterunner)

## Resources

- [Go fuzz yourself - How to find more vulnerabilities through fuzzing - Alissa Knight](https://labs.detectify.com/2021/08/31/go-fuzz-yourself-how-to-find-more-vulnerabilities-in-apis-through-fuzzing-whitepaper-download/?utm_source=referral&utm_medium=referral&utm_campaign=alissaknight)
- [How to hack APIs in 2021 - Hakluke and Farah Hawa](https://labs.detectify.com/2021/08/10/how-to-hack-apis-in-2021/)
- [Better API testing with postman - Mic Whitehorn-Gillam - Part 1](https://www.secureideas.com/blog/2019/03/better-api-penetration-testing-with-postman-part-1.html)
- [Better API testing with postman - Mic Whitehorn-Gillam - Part 2](https://www.secureideas.com/blog/2019/03/better-api-penetration-testing-with-postman-part-2.html)
- [Better API testing with postman - Mic Whitehorn-Gillam - Part 3](https://www.secureideas.com/blog/2019/04/better-api-penetration-testing-with-postman-part-3.html)
- [Better API testing with postman - Mic Whitehorn-Gillam - Part 4](https://www.secureideas.com/blog/2019/06/better-api-penetration-testing-with-postman-part-4.html)
